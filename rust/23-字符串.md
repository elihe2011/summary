# 1. åŸºç¡€çŸ¥è¯†

Rust ä¸­ä¸¤ç§å­—ç¬¦ä¸²ï¼š

- strï¼šåŸç”Ÿå­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹ï¼Œå®ƒè¡¨ç¤º UTF-8 ç¼–ç çš„å­—ç¬¦åºåˆ—ã€‚ä¸ String çš„åŒºåˆ«åœ¨äºï¼Œstr æ˜¯ä¸å¯å˜åˆ‡ç‰‡
- Stringï¼šå¯å¢é•¿çš„å †åˆ†é…å­—ç¬¦ä¸²



## 1.1 åŸºæœ¬æ“ä½œ

```rust
fn str_basic_op() {
    let s = "hello, ä½ å¥½";
    
    // é•¿åº¦
    println!("å­—èŠ‚æ•°ï¼š{}", s.len());           // 13
    println!("å­—ç¬¦æ•°ï¼š{}", s.chars().count()); // 9
    
    // åˆ‡ç‰‡ï¼šå¿…é¡»å¼•ç”¨
    let s1 = &s[..5];  // or [0..5]
    println!("s1: {}", s1); // hello
    
    // UTF-8è¶Šç•Œ, ä¸­æ–‡3ä¸ªå­—èŠ‚
    let s2 = &s[7..9]; 
    println!("s2: {}", s2);  // panic 'ä½ ' (bytes 7..10)
}
```



## 1.2 è¿­ä»£æ“ä½œ

```rust
fn str_iter_op() {
    let s = "Rustä¸­æ–‡";
    
    // å­—èŠ‚è¿­ä»£
    for c in s.chars() {
        print!("{} ", c);
    }
    println!();
    
    // å­—ç¬¦è¿­ä»£
    for b in s.bytes() {
        print!("{:#x} ", b);
    }
    println!();
    
    // å­—ç¬¦èµ·å§‹ä½ç½®
    for (i, c) in s.char_indices() {
        println!("{}: {}", i, c);
    }
}
```



# 2. é«˜çº§ç‰¹æ€§

## 2.1 æ¨¡å¼åŒ¹é…

```rust
fn str_pattern_matching() {
    let s = "Rust is Awesome!";
    
    // å‰ç¼€åç¼€
    assert!(s.starts_with("Rust"));
    assert!(s.ends_with("!"));
    
    // åŒ…å«
    assert!(s.contains("is"));
    
    // ä½ç½®
    assert_eq!(s.find("is"), Some(5));
    assert_eq!(s.find("was"), None);
    
    // é«˜çº§åŒ¹é…
    let matches: Vec<&str> = s.matches(char::is_uppercase).collect();
    println!("å¤§å†™å­—æ¯ï¼š{:?}", matches); // ["R", "A"]
    
    // åˆ†å‰²
    let words: Vec<&str> = s.split_whitespace().collect();
    println!("å•è¯ï¼š{:?}", words);  // ["Rust", "is", "Awesome!"]
}
```



## 2.2 Unicode è§„èŒƒåŒ–

`unicode-normalization` åº“æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥å¤„ç†Unicodeå­—ç¬¦ä¸²çš„è§„èŒƒåŒ–ã€‚è¯¥åº“å›´ç»•ç€Unicodeå­—ç¬¦çš„ç»„åˆï¼ˆcompositionï¼‰å’Œåˆ†è§£ï¼ˆdecompositionï¼‰ï¼Œé€šè¿‡çµæ´»ä¸”é«˜æ•ˆçš„APIå®ç°äº†å¯¹å­—ç¬¦æ“ä½œçš„æ”¯æŒã€‚é‡è¦çš„æ˜¯ï¼Œå®ƒå®Œå…¨å…¼å®¹`no_std`å’Œ`alloc`

å­—ç¬¦ä¸²è§„èŒƒåŒ–ï¼š

- NFCï¼šè§„èŒƒåŒ–ç»„åˆå‹ï¼Œå¦‚ `Ã©` æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚Windows (NFS) å’Œ Linux(ext4) å¸¸ç”¨ NFC å­˜å‚¨æ–‡ä»¶å
- NFDï¼šè§„èŒƒåŒ–åˆ†è§£å‹ï¼Œå¦‚ `Ã©` æ˜¯ä¸¤ä¸ªå­—ç¬¦ `e` å’Œ `Â´`ã€‚MacOS ï¼ˆHFS / APFS) å¸¸ç”¨ NFD å­˜å‚¨æ–‡ä»¶å
- NFKCï¼šå…¼å®¹æ€§ NFC
- NFKDï¼šå…¼å®¹æ€§ NFD

```rust
use unicode_normalization::UnicodeNormalization;

fn unicode_handle() {
    // NFC
    let french = "raison d'Ãªtre";
    let normalized = french.nfc().collect::<String>();
    println!("normalized: {:?}", normalized);
    
    let unicode_str = "ä½ å¥½\u{200D}ğŸ‘¨ğŸ‘©";
    let nfc_str = unicode_str.nfc().collect::<String>();
    println!("nfc_str: {}", nfc_str); // "ä½ å¥½â€ğŸ‘¨ğŸ‘©"
    
    // å¤§å°å†™è½¬æ¢
    let s = french.to_uppercase();
    println!("{}", s);
    
    // é¦–å­—æ¯å¤§å†™
    let title_case = french.chars()
        .enumerate()
        .map(|(i, c)| {
            if i == 0 { c.to_uppercase().next().unwrap() }
            else { c.to_lowercase().next().unwrap() }
        })
        .collect::<String>();
    println!("{}", title_case);
}
```



# 3. æ€§èƒ½ä¼˜åŒ–

## 3.1 å­—ç¬¦ä¸²æœç´¢

```rust
fn efficient_search() {
    let haystack = "This is a very long text that we want to search through efficiently!";
    let needle = "efficiently";
    
    // å¸¸è§„æœç´¢
    if let Some(pos) = haystack.find(needle) {
        println!("Found at position: {}", pos);
    }
    
    // Boyer-Mooreç®—æ³•
    use memchr::memmem; // 2.7.4
    let finder = memmem::Finder::new(needle);
    if let Some(pos) = finder.find(haystack.as_bytes()) {
        println!("Found at position (fast): {}", pos);
    }
}
```



## 3.2 å­—ç¬¦ä¸²æ‹¼æ¥

```rust
fn str_concatenation() {
    let arr = vec!["hello", " ", "world", "!"];
    
    // ä½æ•ˆ
    let mut result = String::new();
    for s in &arr {
        result.push_str(s);
    }
    println!("{}", result);
    
    // é«˜æ•ˆï¼šé¢„åˆ†é…ç©ºé—´
    let length = arr.iter().map(|s| s.len()).sum();
    let mut result = String::with_capacity(length);
    for s in &arr {
        result.push_str(s);
    }
    println!("{}", result);
    
    // æœ€é«˜æ•ˆï¼šjoin
    let result = arr.join("");
    println!("{}", result);
}
```



# 4. åº”ç”¨æ¡ˆä¾‹

## 4.1 å­—ç¬¦ä¸²åˆ†æå™¨

```rust
struct StringAnalyzer<'a> {
    content: &'a str,
}

impl<'a> StringAnalyzer<'a> {
    fn new(content: &'a str) -> Self {
        Self { content }
    }
    
    fn word_frequency(&self) -> std::collections::HashMap<&str, usize> {
        let mut freq = std::collections::HashMap::new();
        for word in self.content.split_whitespace() {
            *freq.entry(word).or_insert(0) += 1;
        }
        freq
    }
    
    fn longest_word(&self) -> Option<&str> {
        self.content
            .split_whitespace()
            .max_by_key(|word| word.len())
    }
    
    fn character_stats(&self) -> (usize, usize, usize) {
        let mut letters = 0;
        let mut digits = 0;
        let mut whitespaces = 0;
        
        for c in self.content.chars() {
            match c {
                c if c.is_alphabetic() => letters += 1,
                c if c.is_numeric() => digits += 1,
                c if c.is_whitespace() => whitespaces += 1,
                _ => {},
            }
        }
        
        (letters, digits, whitespaces)
    }
}
```



## 4.2 å­—ç¬¦ä¸²æ± 

```rust
use std::collections::HashMap;
use std::rc::Rc;

struct StringPool {
    strings: HashMap<String, Rc<str>>,
}

impl StringPool {
    fn new() -> Self {
        Self { 
            strings: HashMap::new(),
        }
    }
    
    fn intern(&mut self, s: &str) -> Rc<str> {
        if let Some(interned) = self.strings.get(s) {
            Rc::clone(interned)
        } else {
            let rc = Rc::from(s.to_string());
            self.strings.insert(s.to_string(), Rc::clone(&rc));
            rc
        }
    }
}
```



# 5. æ€§èƒ½é™·é˜±

## 5.1 UTF-8é™·é˜±

```rust
fn utf8_pitfall() {
    let s = "Rust ä¸­æ–‡";
    
    // é”™è¯¯ç¤ºèŒƒï¼šç›´æ¥å­—èŠ‚ç´¢å¼•
    // let first_char = s[0];
    
    // æ­£ç¡®ç¤ºèŒƒï¼šchars().next()
    let first_char = s.chars().next().unwrap();
    println!("{}", first_char);
    
    // æ€§èƒ½è€ƒè™‘ï¼šéœ€è¦é¢‘ç¹è®¿é—®å­—ç¬¦æ—¶
    let chars: Vec<char> = s.chars().collect();
    let first_char = chars[2];
    println!("{}", first_char);
}
```



## 5.2 å†…å­˜ä¼˜åŒ–

```rust
fn memory_optimization() {
    let s = "hello world!";
    
    // è¾ƒå·®ï¼šåˆ›å»ºæ–°Stringï¼Œå †ä¸Šæ“ä½œ
    let s1 = s.to_string().to_uppercase();
    println!("{}", s1);
    
    // è¾ƒå¥½ï¼šç›´æ¥æ ˆä¸Šæ“ä½œ
    for c in s.chars().map(|c| c.to_uppercase()) {
        print!("{}", c);
    }
}
```



# 6. SmallVec

## 6.1 SmallVec è®¾è®¡

SmallVec æ˜¯ smallvec crate æä¾›çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ—¨åœ¨é€šè¿‡æ ˆåˆ†é…ä¼˜åŒ–å°å‹å‘é‡çš„å­˜å‚¨ï¼ŒåŒæ—¶åœ¨æ•°æ®é‡è¾ƒå¤§æ—¶æ— ç¼åˆ‡æ¢åˆ°å †åˆ†é…ã€‚è¿™ç§æ··åˆå­˜å‚¨æ–¹å¼ç±»ä¼¼äºå­—ç¬¦ä¸²ä¸­çš„â€œå°å‹å­—ç¬¦ä¸²ä¼˜åŒ–â€ (Small String Optimization, SSO)ï¼Œèƒ½å¤Ÿæ˜¾è‘—é™ä½å°å‹æ•°æ®é›†çš„å †åˆ†é…å¼€é”€ã€‚

- **ç»“æ„**ï¼š`SmallVec<[T; N]>` æœ€å¤šå¯åœ¨æ ˆä¸Šå­˜å‚¨ N ä¸ªç±»å‹ä¸º T çš„å…ƒç´ ã€‚å½“å…ƒç´ æ•°é‡è¶…è¿‡ N æ—¶ï¼Œæ•°æ®ä¼šæº¢å‡ºåˆ°å †ä¸Šï¼Œè¡Œä¸ºç±»ä¼¼äºæ ‡å‡† `Vec<T>`
- **å…³é”®ç‰¹æ€§**ï¼š
  - å®ç°äº† `Deref` å’Œ `DerefMut`ï¼Œå¯è½¬æ¢ä¸º `&[T]` å’Œ `&mut [T]`ï¼Œæ”¯æŒåˆ‡ç‰‡æ“ä½œ
  - æ”¯æŒå¸¸è§çš„ `Vec` æ“ä½œï¼Œå¦‚ `push`ã€`pop`ã€`insert` å’Œ `remove`
- ä½¿ç”¨åœºæ™¯ï¼šé€‚ç”¨äºé›†åˆé€šå¸¸è¾ƒå°ï¼ˆä¾‹å¦‚1-8ä¸ªå…ƒç´ ï¼‰ä¸”å †åˆ†é…æˆæœ¬è¾ƒé«˜çš„åœºæ™¯ï¼Œå¦‚æ€§èƒ½æ•æ„Ÿçš„ç³»ç»Ÿæˆ–åµŒå…¥å¼ç¯å¢ƒ

```rust
use smallvec::SmallVec;

fn main() {
    let mut sv: SmallVec<[i32; 4]> = SmallVec::new();
    sv.push(1);
    sv.push(2);
    
    assert_eq!(sv.len(), 2);
    assert!(!sv.spilled());   // åœ¨æ ˆä¸Š
    
    sv.extend_from_slice(&[3, 4, 5]);
    assert!(sv.spilled());  // åˆ‡æ¢åˆ°å †ä¸Š
}
```



## 6.2 String è®¾è®¡

String æ˜¯ Rust æ ‡å‡†åº“ä¸­ç”¨äºå­˜å‚¨å’Œæ“ä½œ UTF-8 ç¼–ç æ–‡æœ¬çš„å¯å¢é•¿å­—ç¬¦ä¸²ç±»å‹ï¼ŒåŸºäº `Vec<u8>` å®ç°ï¼Œå¹¶ä¿è¯æ•°æ®çš„ UTF-8 åˆæ³•æ€§ã€‚

- ç»“æ„ï¼šString å†…éƒ¨æ˜¯å¯¹ `Vec<u8>` çš„å°è£…ï¼Œé™„åŠ äº† UTF-8 ç¼–ç çš„çº¦æŸ
- å…³é”®ç‰¹æ€§ï¼š
  - å®ç°äº† `Deref`ï¼Œå¯ä»¥è½¬æ¢ä¸º `&str`ï¼Œä¾¿äºå­—ç¬¦ä¸²åˆ‡ç‰‡æ“ä½œ
  - æ”¯æŒ `push`ï¼Œ`push_str`ï¼Œ`insert` å’Œ `clear` ç­‰æ“ä½œ
- ä½¿ç”¨åœºæ™¯ï¼šé€‚åˆåŠ¨æ€æ–‡æœ¬å¤„ç†ï¼Œä¾‹å¦‚æ‹¼æ¥å­—ç¬¦ä¸²ã€å¤„ç†ç”¨æˆ·è¾“å…¥æˆ–ç”Ÿæˆæ ¼å¼åŒ–è¾“å‡º

```rust
fn main() {
    let mut s = String::from("Hello");
    s.push_str(", World!");
    assert_eq!(s, "Hello, World!");
}
```



## 6.3 å¯¹æ¯”åˆ†æ

ç›¸ä¼¼ä¹‹å¤„ï¼š

- åŠ¨æ€å¢é•¿ï¼š`SmallVec` å’Œ `String` éƒ½ä¹‹å¤„åŠ¨æ€è°ƒæ•´å¤§å°ï¼ŒæŒ‰éœ€æ‰©å±•å®¹é‡
- å †åˆ†é…ï¼šä¸¤è€…åœ¨å®¹é‡ä¸è¶³æ—¶éƒ½ä¼šä½¿ç”¨å †åˆ†é… (`SmallVec` åœ¨è¶…è¿‡å†…è”å®¹é‡æ—¶ï¼Œ`String` å§‹ç»ˆä½¿ç”¨å †)
- å†…å­˜å®‰å…¨ï¼šä¸¤è€…éƒ½éµå¾ª Rust çš„å®‰å…¨ä¿è¯ï¼Œé¿å…æ— æ•ˆå†…å­˜è®¿é—®æˆ–æœªå®šä¹‰è¡Œä¸º
- `Deref`æ”¯æŒï¼šä¸¤è€…å‡å®ç°äº† `Deref`ï¼Œä¾¿äºè®¿é—®åº•å±‚æ•°æ®(`SmallVec` ä¸º `&[T]`ï¼Œ`String` ä¸º `&str`)



ä¸åŒä¹‹å¤„ï¼š

| ç‰¹æ€§           | SmallVec              | String                     |
| -------------- | --------------------- | -------------------------- |
| **ç”¨é€”**       | é€šç”¨å°å‹å‘é‡          | UTF-8 ç¼–ç çš„æ–‡æœ¬           |
| **å­˜å‚¨æ–¹å¼**   | æ ˆ (æœ€å¤šNä¸ªå…ƒç´ ) æˆ–å † | å§‹ç»ˆåœ¨å †ä¸Š (é€šè¿‡`Vec<u8>`) |
| **ç±»å‹çµæ´»æ€§** | æ³›å‹ (T)              | å›ºå®šä¸º u8 (UTF-8 å­—èŠ‚)     |
| **ä¼˜åŒ–ç­–ç•¥**   | å°å‹å­—ç¬¦ä¸²ä¼˜åŒ–        | æ— å†…è”å­˜å‚¨                 |
| **API**        | ç±»å‹å‘é‡ (push, pop)  | å­—ç¬¦ä¸²ä¸“ç”¨ (push_str)      |
| **ä½¿ç”¨åœºæ™¯**   | æ€§èƒ½æ•æ„Ÿçš„å°å‹é›†åˆ    | æ–‡æœ¬å¤„ç†                   |



## 6.4 å®é™…åº”ç”¨

### 6.4.1 SmallVec è§£æä»¤ç‰Œ

åœ¨ç¼–è¯‘å™¨æˆ–è§£é‡Šå™¨çš„ä»¤ç‰Œè§£æåœºæ™¯ä¸­ï¼Œè¡¨è¾¾å¼é€šå¸¸åŒ…å«å°‘é‡ä»¤ç‰Œï¼Œ`SmallVec` æ˜¯ç†æƒ³é€‰æ‹©

```rust
use smallvec::SmallVec;

fn parse_tokens(input: &str) -> SmallVec<[&str; 8]> {
    let mut tokens: SmallVec<[&str; 8]> = SmallVec::new();
    for token in input.split_whitespace() {
        tokens.push(token);
    }
    
    tokens
}

fn main() {
    let tokens = parse_tokens("let x = 42");
    assert_eq!(tokens, &["let", "x", "=", "42"]);
}
```



### 6.4.2 String ç”Ÿæˆ CSVè¡Œ

åœ¨åŠ¨æ€ç”Ÿæˆ CSV æ•°æ®æ—¶ï¼Œ`String` é€‚åˆæ‹¼æ¥å­—æ®µ

```rust
fn build_csv_row(fields, &[&str]) -> String {
    let mut row = String::new();
    for (i, field) in fields.iter().enumerate() {
        if i > 0 {
            row.push(',');
        }
        row.push_str(feild);
    }
    row
}

fn  main() {
    let row = build_csv_row(&["Alice", "25", "Engineer"]);
    assert_eq!(row, "Alice,25,Engineer");
}
```



### 6.4.3 ç»“åˆä½¿ç”¨

ä¸€ä¸ªæ—¥å¿—è§£æå™¨å¯èƒ½ä½¿ç”¨ `SmallVec` å­˜å‚¨æ—¥å¿—çº§åˆ«ï¼Œ`String` å­˜å‚¨æ¶ˆæ¯å†…å®¹

```rust
use smallvec::SmallVec;

struct LogEntry {
    levels: SmallVec<[&str; 4]>,
    message: String,
}

fn create_log_entry(levels: &[&str], msg: &str) -> LogEntry {
    LogEntry {
        levels: levels.iter().copied().collect(),
        message: msg_to_string(),
    }
}

fn main() {
    let entry = create_log_entry(&["INFO", "DEBUG"], "ç³»ç»Ÿå¯åŠ¨");
    assert_eq!(entry.levels.len(), 2);
    assert_eq!(entry.message, "ç³»ç»Ÿå¯åŠ¨");
}
```



# 7. String å’Œ str æ€»ç»“

## 7.1 åŸºæœ¬å®šä¹‰

### 7.1.1 String

- **String**ï¼šå°è£…äº† `Vec[u8]` çš„ç»“æ„ä½“ï¼Œåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œæ”¯æŒä¿®æ”¹æ‰©å®¹

  ```
  æ ˆï¼š[String { ptr, len, cap }]
        |
        v
  å †ï¼š[ h e l l o ]
  ```

- **&String**ï¼šString ç»“æ„ä½“çš„ä¸å¯å˜å€Ÿç”¨

  ```
  æ ˆï¼š[String { ptr, len, cap }]
  æ ˆï¼š[&String] -----> String ç»“æ„ä½“
                        |
                        v
                      å †æ•°æ®
  ```

- **&mut String**ï¼šString ç»“æ„ä½“çš„å¯å˜å€Ÿç”¨

  ```
  æ ˆï¼š[String { ptr, len, cap }]
  æ ˆï¼š[&mut String] ---> String ç»“æ„ä½“ (å¯ä¿®æ”¹)
  ```



### 7.1.2 str

- **str**ï¼šDST (Dynamically Sized Type)ç±»å‹ï¼Œç¼–è¯‘æ—¶æ— æ³•ç¡®å®šå¤§å°ï¼ŒRust ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸéœ€è¦çŸ¥é“ä¸€ä¸ªç±»å‹çš„å¤§å°ï¼Œæ‰èƒ½åœ¨æ ˆä¸Šä¸ºå…¶åˆ†é…å†…å­˜ï¼Œå› æ­¤æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚å…¶æœ¬è´¨ä¸Šæ˜¯ä¸€æ®µ UTF-8 å­—èŠ‚åºåˆ—ï¼Œå¤§å°åªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“ï¼Œä¸€èˆ¬è¦ **å°†å…¶æ”¾åœ¨å¼•ç”¨æˆ–æ™ºèƒ½æŒ‡é’ˆä¸­** ä½¿ç”¨
- **&str**ï¼šå¯¹å­—ç¬¦ä¸²å†…å®¹çš„ä¸å¯å˜å€Ÿç”¨ã€‚æœ‰ä¸‰ä¸ªæ¥æºï¼šStringã€å­—ç¬¦ä¸²å­—é¢é‡ã€æŸä¸ªåˆ‡ç‰‡

  ```
  æ ˆï¼š[&String { ptr -> å †æ•°æ®, len, cap }]     // å€Ÿç”¨æ•´ä¸ª String å¯¹è±¡
  æ ˆï¼š[&str { ptr -> å †æ•°æ®ï¼Œ len } ]           // å€Ÿç”¨å †ä¸­ å­—ç¬¦ä¸²æ•°æ® ç‰‡æ®µ
  ```

- **&mut str**ï¼šå¯¹æŸæ®µå­—ç¬¦ä¸²å†…å®¹çš„å¯å˜å€Ÿç”¨ã€‚å¾ˆå°‘å•ç‹¬ä½¿ç”¨ï¼Œå¤šè§äºåˆ‡ç‰‡æ“ä½œ

  ```rust
  let mut s = String::from("hello");
  let slice: &mut str = &mut s[..];   // å¯å˜åˆ‡ç‰‡
  ```



## 7.2 ç›¸äº’è½¬æ¢

### 7.2.1 &String è½¬ &str

- è‡ªåŠ¨è§£å¼•ç”¨ (Deref coercion) åœ¨å¤§å¤šæ•°å‡½æ•°è°ƒç”¨æˆ–èµ‹å€¼åœºæ™¯ä¸‹ï¼Œ`&String` ä¼šè‡ªåŠ¨è½¬æ¢æˆ `&str`

  ```rust
  fn print_str(s: &str) {
      println!("{}", s);
  }
  
  let s = String::from("hello");
  print_str(&s);  // &String è‡ªåŠ¨è½¬æˆ &str
  ```

- æ‰‹åŠ¨è°ƒç”¨ `.as_str()`

  ```rust
  let s = String::from("world");
  let slice: &str = s.as_str();
  ```



### 7.2.2 &str è½¬ String

- å…‹éš†æ•°æ®ï¼Œå †åˆ†é…æ–°å†…å­˜ï¼Œå¹¶æ‹¥æœ‰æ‰€æœ‰æƒ

  ```rust
  let s: &str = "hello";
  let s1: String = s.to_string();
  let s2: String = String::from(s);
  ```

- ä½¿ç”¨å€Ÿç”¨(&String)æ—¶ï¼Œä¸éœ€è¦å…ˆè½¬æ¢ä¸º Stringï¼Œç›´æ¥ä½¿ç”¨ &str å³å¯



## 7.3 ä½¿ç”¨åœºæ™¯

### 7.3.1 str

- **&str**ï¼š

  - æ›´åŠ é€šç”¨å’Œé«˜æ•ˆï¼Œå¤§å¤šæ•°å‡½æ•°å‚æ•°éƒ½åº”è¯¥å†™æˆ `&str`ï¼Œå®ƒèƒ½åŒæ—¶æ¥å—å­—é¢é‡ã€Stringã€ç”šè‡³åˆ«çš„åˆ‡ç‰‡ã€‚`&str` æ˜¯å¸¸è§„é€‰æ‹©ï¼Œå¦‚æœä¸æƒ³å†™ &ï¼Œå¯¹å¤–çš„åº“æ¨èç”¨ **`AsRef<str>`**ï¼Œæ¥å— `String`, `&String`, `&str` ç›´æ¥ä¼ å…¥

    ```rust
    fn greet(name: &str) {
        println!("Hello, {}", name);
    }
    
    greet("Alice");               // å­—é¢é‡
    greet(&String::from("Bob"));  // &String
    ```

  - å®šä¹‰å­—ç¬¦ä¸²å­—é¢é‡ (æ”¾åœ¨åªè¯»å­—æ®µ)ï¼Œé›¶å¼€é”€ã€æ— éœ€å †å†…å­˜ï¼Œè‡ªåŠ¨å®‰å…¨ç®¡ç†ã€‚é€‚åˆå›ºå®šæ–‡æœ¬ã€å¸¸é‡é…ç½®ã€æ¶ˆæ¯æ¨¡æ¿ç­‰

    ```rust
    static GREETING: &str = "hello world!";
    
    fn main() {
        println!("{}", GREETING);
    }
    ```

  - å®šä¹‰åŸå§‹å­—é¢é‡ (`r"..."`)

    ```rust
    let raw: &str = r"hello\nworld!";
    
    let raw: &str = r#"a string with "qutotes""#;
    let raw: &str = r##"a string with "# inside"##;
    ```

  - å®šä¹‰å­—èŠ‚å­—ç¬¦ä¸²å­—é¢é‡ (`b"..."`)

    ```rust
    let bytes: &[u8; 5] = b"hello";
    ```

  - åŸå§‹å­—èŠ‚å­—ç¬¦ä¸² (`br"..."` æˆ– `br#"..."#`)

    ```rust
    let raw_bytes: &[u8] = br"hello\nworld!";
    let raw_bytes: &[u8] = br#"with "quotes""#;
    ```

- **&mut str**

  - å°±åœ°ä¿®æ”¹å†…å®¹é•¿åº¦ ä¸å˜ï¼Œç”¨ `&mut str` æ›´ä¼˜é›…

    ```rust
    fn shout(buf: &mut str) {
        buf.make_ascii_uppercase();
    }
    
    fn main() {
        let mut s = String::from("hello rust");
        shout(&mut s);
        println!("{}", s);
    }
    ```
  
  - éƒ¨åˆ†åˆ‡ç‰‡ä¿®æ”¹ï¼Œåªèƒ½ç”¨ `&mut str`
  
    ```rust
    fn fix_prefix(buf: &mut str) {
        buf.make_ascii_uppercase();
    }
    
    fn main() {
        let mut s = String::from("hello world");
        {
            let prefix = &mut s[0..5];
            fix_prefix(prefix);
        }
        println!("{}", s);
    }
    ```
  
    <font color="red">åªæœ‰ `&mut str` èƒ½ç›´æ¥æ“ä½œå­ä¸²ï¼›`&mut String` æ“ä½œçš„æ˜¯æ•´ä¸ªå­—ç¬¦ä¸²</font>
  
  
  
### 7.3.2 String

- **`String`**ï¼šéœ€è¦**å¯å˜ã€æ‹¥æœ‰æ‰€æœ‰æƒ**çš„å­—ç¬¦ä¸²æ—¶ï¼Œæ¯”å¦‚å‡½æ•°è¿”å›å€¼ã€æ‹¼æ¥ä¿®æ”¹å­—ç¬¦ä¸²ã€å­—ç¬¦ä¸²å†™å…¥ Vecã€HashMap ç­‰ä¸­(è¿™äº›å®¹å™¨éœ€è¦æ‹¥æœ‰æ‰€æœ‰æƒ)

  ```rust
  let mut s = String::from("Hello");
  s.push_str(", Rust!")
  ```

- **`&String`**ï¼šå‡½æ•°ç­¾åä¸€èˆ¬ä¸ä½¿ç”¨ `&String`ï¼Œè¿™ä¼šé™åˆ¶è°ƒç”¨è€…å¿…é¡»ä¼ å…¥ Stringï¼Œè€Œä¸æ˜¯å­—é¢é‡ï¼Œå‡½æ•°ç­¾åå‡ ä¹éƒ½ä½¿ç”¨ `&str`

- **`&mut String`**ï¼šä¿®æ”¹åŸæœ‰å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚å›æº¯ã€æ‹¼æ¥ã€æ‰©å±•ã€åˆ é™¤å­—ç¬¦

  ```rust
  fn build_sentence(buf: &mut String) {
      buf.push('H');
      buf.push_str("ello");
      buf.push(' ');
      buf.push_str("Rust");
  }
  
  fn shrink(buf: &mut String) {
      buf.push_str("abcde");
      buf.pop(); // åˆ é™¤æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œå³ e
      buf.truncate(3); // åˆ é™¤ç´¢å¼•3åŠåé¢çš„å­—ç¬¦ï¼Œå³ åˆ é™¤ abc ä¹‹åçš„å­—ç¬¦
  }
  ```

  

### 7.3.3 ç»“æ„ä½“å­—ç¬¦ä¸²

- **`String`**ï¼šç®€å•ã€çµæ´»ã€æœ€å¸¸è§ã€‚ç»“æ„ä½“å®ä¾‹å®Œå…¨æ‹¥æœ‰å­—ç¬¦ä¸²ï¼Œå¸¸è§äºæŒä¹…åŒ–æ•°æ®æ¨¡å‹ï¼Œå¦‚æ•°æ®å®ä½“ç­‰ã€‚ä¸šåŠ¡å¼€å‘é¦–é€‰ï¼Œä¸ç”¨è€ƒè™‘ç”Ÿå‘½å‘¨æœŸ

  ```rust
  struct User {
      name: String,
      email: String,
  }
  ```

- **`&str`**ï¼šåªè¯»æ•°æ®ï¼Œä¾èµ–å¤–éƒ¨ç”Ÿå‘½å‘¨æœŸ

  ```rust
  struct User<'a> {
      name: &'a str,
      email: &'a str,
  }
  ```

- **`Cow<'a, str>`**ï¼šè¦å…¼é¡¾å¼•ç”¨å’Œæ‰€æœ‰æƒã€‚ç»“æ„ä½“æ—¢èƒ½æ¥å—å¼•ç”¨çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿèƒ½æ‹¥æœ‰å­—ç¬¦ä¸²ã€‚å¦‚è§£æé…ç½®ã€æ–‡æœ¬å¤„ç†å‡½æ•°çš„å‚æ•°ç­‰

  ```rust
  use std::borrow::Cow;
  
  struct User<'a> {
      name: Cow<'a, str>
  }
  ```

- **`Box<str>`**ï¼šéœ€è¦ä¼˜åŒ–å†…å­˜å¸ƒå±€ã€‚æ¯” String å†…å­˜æ›´ç´§å‡‘ï¼Œå­˜å‚¨åä¸èƒ½å†ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå ç”¨æ›´å°ï¼Œå†…å­˜å¸ƒå±€æ›´ç¨³å®š(é€‚åˆ FFI æˆ–å†…å­˜ä¼˜åŒ–åœºæ™¯)ï¼ŒåµŒå…¥å¼ä¸­å¸¸è§

  ```rust
  struct User {
      name: Box<str>,
  }
  ```

  

## 7.4 API å¯¹æ¯”

### 7.4.1 ç›¸åŒçš„

`String` è‡ªåŠ¨è§£å¼•ç”¨ä¸º `str`ï¼Œæ‰€ä»¥è¿™äº›æ–¹æ³•é€šç”¨ï¼š

| åˆ†ç±»           | æ–¹æ³•               | ä½œç”¨                     |
| :------------- | :----------------- | :----------------------- |
| **åŸºæœ¬ä¿¡æ¯**   | `len`              | è¿”å›å­—èŠ‚é•¿åº¦             |
|                | `is_empty`         | æ˜¯å¦ä¸ºç©º                 |
|                | `chars`            | è¿”å›å­—ç¬¦è¿­ä»£å™¨           |
|                | `bytes`            | è¿”å›å­—èŠ‚è¿­ä»£å™¨           |
|                | `char_indices`     | å­—ç¬¦+ç´¢å¼•è¿­ä»£            |
|                | `as_ptr`           | è·å–åŸå§‹æŒ‡é’ˆ             |
|                | `as_bytes`         | è·å–å­—èŠ‚åˆ‡ç‰‡ `&[u8]`     |
| **å­ä¸²æ£€æŸ¥**   | `contains`         | æ˜¯å¦åŒ…å«å­ä¸²             |
|                | `starts_with`      | æ˜¯å¦æœ‰å‰ç¼€               |
|                | `ends_with`        | æ˜¯å¦æœ‰åç¼€               |
|                | `find`             | æŸ¥æ‰¾å­ä¸²ä½ç½®             |
|                | `rfind`            | ä»å³ä¾§æŸ¥æ‰¾               |
|                | `matches`          | æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…             |
|                | `match_indices`    | æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…ï¼ˆå¸¦ç´¢å¼•ï¼‰   |
| **å­ä¸²è·å–**   | `get`              | å®‰å…¨åˆ‡ç‰‡                 |
|                | `[range]`          | ä¸‹æ ‡åˆ‡ç‰‡                 |
|                | `split_at`         | æŒ‰ä¸‹æ ‡æ‹†åˆ†               |
| **åˆ†å‰²ä¸è¿­ä»£** | `split`            | æŒ‰åˆ†éš”ç¬¦åˆ‡åˆ†             |
|                | `rsplit`           | ä»å³è¾¹åˆ‡åˆ†               |
|                | `split_whitespace` | æŒ‰ç©ºç™½åˆ‡åˆ†               |
|                | `lines`            | æŒ‰è¡Œåˆ‡åˆ†                 |
| **ä¿®å‰ª**       | `trim`             | å»æ‰é¦–å°¾ç©ºç™½             |
|                | `trim_start`       | å»æ‰å¼€å¤´ç©ºç™½             |
|                | `trim_end`         | å»æ‰ç»“å°¾ç©ºç™½             |
|                | `trim_matches`     | å»æ‰åŒ¹é…æ¨¡å¼             |
| **è½¬æ¢**       | `to_lowercase`     | è½¬å°å†™ (è¿”å› `String`)   |
|                | `to_uppercase`     | è½¬å¤§å†™ (è¿”å› `String`)   |
|                | `to_string`        | è½¬ `String`              |
|                | `repeat`           | é‡å¤æ‹¼æ¥ (è¿”å› `String`) |
| **æ¯”è¾ƒ**       | `eq`               | åˆ¤æ–­ç›¸ç­‰                 |
|                | `cmp`              | æ¯”è¾ƒé¡ºåº                 |



### 7.4.2 Stringç‹¬æœ‰

| ç±»åˆ«           | æ–¹æ³•                   | ä½œç”¨               |
| :------------- | :--------------------- | :----------------- |
| **å®¹é‡ç®¡ç†**   | `capacity`             | å½“å‰åˆ†é…çš„å®¹é‡     |
|                | `reserve`              | é¢„ç•™é¢å¤–å®¹é‡       |
|                | `reserve_exact`        | ç²¾ç¡®é¢„ç•™å®¹é‡       |
|                | `shrink_to_fit`        | é‡Šæ”¾å¤šä½™å®¹é‡       |
| **ä¿®æ”¹**       | `push`                 | è¿½åŠ ä¸€ä¸ªå­—ç¬¦       |
|                | `push_str`             | è¿½åŠ ä¸€ä¸ªå­—ç¬¦ä¸²     |
|                | `insert`               | åœ¨æŒ‡å®šä½ç½®æ’å…¥å­—ç¬¦ |
|                | `insert_str`           | æ’å…¥å­—ç¬¦ä¸²         |
|                | `remove`               | åˆ é™¤æŸä¸ªå­—ç¬¦       |
|                | `retain`               | æŒ‰æ¡ä»¶ä¿ç•™å­—ç¬¦     |
|                | `truncate`             | æˆªæ–­åˆ°æŒ‡å®šé•¿åº¦     |
|                | `clear`                | æ¸…ç©ºå­—ç¬¦ä¸²         |
|                | `make_ascii_lowercase` | ASCII è½¬å°å†™       |
|                | `make_ascii_uppercase` | ASCII è½¬å¤§å†™       |
| **è½¬ç§»æ‰€æœ‰æƒ** | `into_boxed_str`       | è½¬ä¸º `Box<str>`    |



### 7.4.3 strç‹¬æœ‰

è¿™äº›æ–¹æ³•æ˜¯ **åˆ‡ç‰‡çº§åˆ«** çš„ï¼Œä¸ä¼šæ”¹å˜åº•å±‚æ•°æ®ï¼Œé€šå¸¸è¿”å›æ–°çš„åˆ‡ç‰‡æˆ–è¿­ä»£å™¨ã€‚

| ç±»åˆ«         | æ–¹æ³•             | ä½œç”¨               |
| :----------- | :--------------- | :----------------- |
| **æ¨¡å¼åŒ¹é…** | `strip_prefix`   | å»æ‰å‰ç¼€ï¼Œè¿”å›å­ä¸² |
|              | `strip_suffix`   | å»æ‰åç¼€ï¼Œè¿”å›å­ä¸² |
| **åˆ‡ç‰‡å·¥å…·** | `split_once`     | æŒ‰ç¬¬ä¸€æ¬¡åŒ¹é…åˆ‡åˆ†   |
|              | `rsplit_once`    | æŒ‰æœ€åä¸€æ¬¡åŒ¹é…åˆ‡åˆ† |
| **æŒ‡é’ˆå·¥å…·** | `as_ptr_range`   | å¾—åˆ°æŒ‡é’ˆèŒƒå›´       |
| **è½¬ä¹‰å·¥å…·** | `escape_debug`   | å¯æ‰“å°è°ƒè¯•è½¬ä¹‰     |
|              | `escape_default` | é»˜è®¤è½¬ä¹‰           |
|              | `escape_unicode` | Unicode è½¬ä¹‰       |







