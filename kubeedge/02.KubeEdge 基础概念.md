# 1. 边缘计算

边缘计算平台，旨在将边缘端靠近数据源的计算单元纳入到中心云，实现集中管理，将云服务部署其上，及时响应终端请求。然而，成千上万的边缘节点散布于各地，例如银行网点、车载节点、加油站等基于一些边缘设备管理场景，服务器分散在不同城市，无法统一管理，为了优化集群部署以及统一管理，特探索边缘计算场景方案。

“边缘”特指计算资源在地理分布上更加靠近设备，而远离云数据中心的资源节点。典型的边缘计算分为物联网（例如：下一代工业自动化，智慧城市，智能家居，大型商超等）和非物联网（例如：游戏，CDN等）场景。

在现实世界中，边缘计算无法单独存在，它必定要和远程数据中心（云）打通。以IoT（Internet of Things，物联网）为例，边缘设备除了拥有传感器收集周边环境的数据外，还会从云端接收控制指令。

边缘设备与云连接一般有两种模式：直连和通过中继边缘节点连接

![edge-compute](https://fastly.jsdelivr.net/gh/elihe2011/bedgraph@master/kubeedge/edge-compute.png)

当前边缘计算领域面临的几个挑战：

- 云边协同：AI/安全等业务在云和边的智能协同、弹性迁移；
- 网络：边缘网络的可靠性和带宽限制；
- 管理：边缘节点的资源管理与边缘应用生命周期管理；
- 扩展：高度分布和大规模的可扩展性；
- 异构：边缘异构硬件和通信协议。



设备管理解决的问题：

- 边缘端的数据采集比较困难，工厂设备的工业通信协议比较多，需要花费大量时间去适配工厂的设备协议。

- 设备上传的原数据比较多而杂，如果全部直接上云的话，会对网络带宽有较高要求，并且这些无效的数据会占据大量的云端资源去处理和分析。

- 数据上云，会导致数据响应不及时，导致生产停顿的状况。

- 数据的安全性问题，很多行业由于其特性或者要求数据必须在边缘端直接就近处理，但云计算数据上云的话，会导致一些不可预料的结果，所以需要在边缘侧直接处理数据脱敏问题。

![image](https://fastly.jsdelivr.net/gh/elihe2011/bedgraph@master/kubeedge/edge-smart-factory.png)

云边协同：

![image](https://fastly.jsdelivr.net/gh/elihe2011/bedgraph@master/kubeedge/edge-cloud-collaboration.png)

# 2. Kubernetes

Kubernetes已经成为云原生的标准，并且能够在任何基础设施上提供一致的云上体验。

Kubernetes的优点：

- 容器的轻量化和可移植性非常适合边缘计算的场景；
- Kubernetes已经被证明具备良好的可扩展性；
- 能够跨底层基础设施提供一致的体验；
- 同时支持集群和单机运维模式；
- Workload抽象，例如：Deployment和Job等；
- 应用的滚动升级和回滚；
- 围绕Kubernetes已经形成了一个强大的云原生技术生态圈，诸如：监控、日志、CI、存储、网络都能找到现成的工具链；
- 支持异构的硬件配置（存储、CPU、GPU等）；
- 用户可以使用熟悉的kubectl或者helm chart把IoT应用从云端推到边缘；
- 边缘节点可以直接映射成Kubernetes的Node资源，而Kubernetes的扩展 API（CRD）可以实现对边缘设备的抽象。



Kubernetes 在边缘计算方面的不足：

- 网络断连时，节点异常或重启时，内存数据丢失，业务容器无法恢复;
- 网络长时间断连，云端控制器对业务容器进行驱逐;
- 长时间断连后网络恢复时，边缘和云端数据的一致性保障；

- 很多设备边缘的资源规格有限，特别是CPU处理能力较弱，因此无法部署完整的Kubernetes；
- 它非常依赖list/watch机制，不支持离线运行，而边缘节点的离线又是常态，例如：设备休眠重启；
- 特殊的网络协议和拓扑要求。设备接入协议往往非TCP/IP协议，例如，工业物联网的Modbus和OPC UA，消费物联网的Bluetooth和ZigBee等；



# 3. KubeEdge

KubeEdge 是一个开源系统，用于将本机容器化的应用程序编排功能扩展到 Edge 边缘设备上，它基于 kubernetes 构建，并为网络、应用程序提供基本的架构支持，云和边缘之间的部署和元数据同步。

KubeEdge 重点解决的问题：

- 云边协同
- 资源异构
- 大规模
- 轻量化
- 一致的设备管理和接入体验



## 3.1 特点

- 完全开放：EdgeCore 和 CloudCore 都是开源的
- 离线模式：即使与Cloud断开连接，Edge也可以运行
- 基于Kubernetes：节点、集群、应用程序和设备管理；可扩展、容器化、微服务
- 资源优化：可以在资源不足的情况下运行，边缘云上资源的优化利用
- 跨平台：无感知，可在私有、共有和混合云上工作
- 数据和分析：支持数据管理、数据跟新管道引擎
- 异构：可支持 x86, arm
- 简化开发：基于DK的设备加成，应用程序部署等开发
- 易于维护：升级、回滚、监视、警报等



## 3.2 优势

- 边缘计算：通过在 Edge 上运行的业务逻辑，可以边缘端生成和处理大量数据，减少了网络带宽需求即边缘和云之间的消耗。这样提高了响应速度，降低成本并保护客户端数据隐私
- 简化开发：开发人员可以编写基于常规http、mqtt的应用程序，对其进行容器化，然后在 Edge 或 Cloud 中的任何位置运行他们中更合适的一个
- kubernetes 原生支持：借助 KubeEdge，用户可以在 Edge节点上编排应用，管理设备并监视应用和设备状态，可轻松将现有复杂的机器学习、图像识别和事件处理即其他高级应用部署到 Edge



## 3.3 功能

kubeedge 云上部分和k8s功能无差别，主要为k8s 功能。

在kubeedge概念中，edge设备与cloud设备无法双向互通，其假设cloud端开发一个用于公开访问的端点（即cloudcore的websocket端点），edge设备通过该端点与cloud 同步，上报节点信息，接受cloud任务下发。

其中运行在edge边的部分由edgecore实际控制，edgecore还向更下层设备提供http/mqtt接口用于更下层设备接入。其本身亦可为执行工作负载。

典型应用场景

![img](https://fastly.jsdelivr.net/gh/elihe2011/bedgraph@master/kubeedge/device-status-update.png)

## 3.4 核心理念

- 云边协同
  - 双向多路复用消息通道，支持边缘节点位于私有网络
  - Websocket + 消息封装，大幅减少通信压力，高时延下任可正常工作
- 边缘离线自治
  - 节点元数据持久化，实现节点级离线自治
  - 节点故障恢复无需List-watch，降低网络压力，快速ready
- 极致轻量
  - 重组kubelet功能模块(移除内嵌存储驱动，通过CSI接入)，极致轻量化 (约10mb内存占用)
  - 支持CRI集成 Containerd、CRI-O，优化 runtime 资源消耗



kubeedge总体来说解决了两个问题：

- 解决了云边网络不对等问题。精简/重新设计的edgehub，解决了云无法直接访问边缘设备的问题。将原kubelet的通信和功能使用websocket进行实现。由边缘设备发起链接，通过云中的配套服务转换注册进入云集群。
- 边缘设备管理与消息处理。
  - 设备型号注册。将一个型号的设备和其属性以k8s自定义资源注册进入云端，支持定义其属性，属性定义用于确定消息下发的数据结构。
  - 设备实例管理。将实际运行的边缘设备实例以k8s自定义资源注册进入云端，在云端对属性进行更改后，通过边缘设备mqtt将消息推送至边缘设备，边缘设备针对属性更改进行实际处理。
  - 设备实例操作。提供http接口对已经注册的边缘设备属性进行更改，更改会通过kubeedge转换为mqtt消息下发至对应设备。
