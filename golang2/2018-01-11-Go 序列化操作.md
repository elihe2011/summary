---
layout: post
title:  Go 序列化操作
date:   2018-01-11 09:24:54
comments: true
photos: 
tags: 
  - go
categories: Golang
---


# 1. 序列化

`json.Marshal(v interface{}) ([]byte, error)`

<!-- more -->

```go
type Person struct {
	Name       string  `json:"name"`
	Age        byte    `json:"age"`
	Birthday   string  `json:"birthday"`
	Salary     float64 `json:"salary"`
	Occupation string  `json:"occupation"`
}

func main() {
	serializeStruct()

	serializeMap()

	serializeSlice()
}

func serializeStruct() {
	p := Person{
		Name:       "张三",
		Age:        45,
		Birthday:   "1975-05-01",
		Salary:     32000.0,
		Occupation: "电气工程师",
	}

	data, err := json.Marshal(&p)
	if err != nil {
		fmt.Println(err)
	}

	fmt.Println(string(data))
}

func serializeMap() {
	var m map[string]interface{}

	m = make(map[string]interface{})

	m["name"] = "李四"
	m["age"] = 30
	m["city"] = "北京市"

	data, err := json.Marshal(m)
	if err != nil {
		fmt.Println(err)
	}

	fmt.Println(string(data))
}

func serializeSlice() {
	var s []map[string]interface{}

	m1 := make(map[string]interface{})
	m1["name"] = "Tom"
	m1["age"] = 17
	m1["city"] = "Los Angles"

	m2 := make(map[string]interface{})
	m2["name"] = "Julie"
	m2["age"] = 21
	m2["city"] = "New York"

	s = append(s, m1, m2)

	data, err := json.Marshal(s)
	if err != nil {
		fmt.Println(err)
	}

	fmt.Println(string(data))
}
```

# 2. 反序列化

`json.Unmarshal(data []byte, v interface{}) error`

```go
type Person struct {
	Name       string  `json:"name"`
	Age        byte    `json:"age"`
	Birthday   string  `json:"birthday"`
	Salary     float64 `json:"salary"`
	Occupation string  `json:"occupation"`
}

func main() {
	deserializeStruct()

	deserializeMap()

	deserializeSlice()
}

func deserializeStruct() {
	js := `{"name":"张三","age":45,"birthday":"1975-05-01","salary":32000,"occupation":"电气工程师"}`

	var p Person

	err := json.Unmarshal([]byte(js), &p)
	if err != nil {
		fmt.Println(err)
	}

	fmt.Println(p)
}

func deserializeMap() {
	js := `{"age":30,"city":"北京市","name":"李四"}`

	var m map[string]interface{}

	// 反序列化不需要make，注意使用指针 &m
	err := json.Unmarshal([]byte(js), &m)
	if err != nil {
		fmt.Println(err)
	}

	fmt.Println(m)
}

func deserializeSlice() {
	js := `[{"age":17,"city":"Los Angles","name":"Tom"},{"age":21,"city":"New York","name":"Julie"}]`

	var s []map[string]interface{}

	// 反序列化不需要make，注意使用指针 &s
	err := json.Unmarshal([]byte(js), &s)
	if err != nil {
		fmt.Println(err)
	}

	fmt.Println(s)
}
```